<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>진단 모드</title>
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;padding:16px}
    button{font-size:16px;padding:10px 14px}
    #status{white-space:pre-wrap;font-size:14px;background:#f9fafb;border:1px solid #eee;border-radius:8px;padding:10px;min-height:64px;margin-top:12px}
  </style>
</head>
<body>
  <h2>진단 모드 — 클릭/스크립트/네트워크 확인</h2>
  <p>아래 버튼을 누르면 로그가 순서대로 찍혀야 정상입니다.</p>
  <button id="ping" type="button">진단 버튼</button>
  <pre id="status"></pre>

  <script>
    const $ = id => document.getElementById(id);
    const log = m => { const s=$('status'); s.textContent += (s.textContent?'\n':'') + m; };

    window.addEventListener('error', e => log('❌ window.error: ' + e.message));
    log('✅ 스크립트 로드됨');

    $('ping').addEventListener('click', async () => {
      log('➡️ 클릭 이벤트 수신, /api/upload POST 테스트 시작');
      try {
        const form = new FormData();
        form.append('pin','6364');
        form.append('vet','김지현');
        form.append('patient','진단환자');
        form.append('owner','진단보호자');
        form.append('title','진단제목');
        // 파일은 의도적으로 안 넣음 (서버가 JSON으로 에러 내려주는지 확인)
        const res = await fetch('/api/upload', { method: 'POST', body: form });
        const ct = res.headers.get('content-type') || '';
        const body = ct.includes('application/json') ? await res.json() : { ok:false, error: await res.text() };
        log('⬅️ 서버 응답: ' + JSON.stringify(body));
      } catch (e) {
        log('❌ 네트워크 예외: ' + e.message);
      }
    });
  </script>
</body>
</html>
